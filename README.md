Прототип с одним уровнем игры "Выживи сражаясь".

Ваш герой должен выжить, зашитить замок от разрушения победив босса противников.

Управление: кнопки W A S D для движения вперёд (назад) и поворота. Удар оружием - левая Ctrl или левая кнопка мышки. Прыжок - пробел. Поменять оружие - E. Клавишей TAB можно менять камеру с видом сверху на камеру от третьего лица и наоборот.

Герой начинает с Мечом (урон 5) и Щитом. В городе можно найти Топор (урон 10) и Булаву (урон 20). По всему пути героя расположены блок-посты врагов. Чем ближе к замку, тем сильнее враги - лучше оружие (дубина 2, молот 4, торор 7, булава 10 урона) и больше здоровья (10, 15, 20, 25). За уничтожение врагов герой получает опыт и монеты. Каждые 100 очков опыта дают +10 к максимальному здоровью (вначале - 100). Сражаясь, герой теряет здоровье, которое можно восполнить, подбирая бонусы - яблоки и аптечки. Яблоко мгновенно восстанавливает 10 очков здоровья. Аптечка восстанавливает 30 очков здоровья, если его осталось менее 50% или накапливается. Если в других схватках здоровье снизится менее 50%, то аптечка будет использована автоматически. В городе есть два магазина (прозрачные кубы), в которых за накопленные монеты можно купить яблоки и аптечки. 

Когда герой проходит рядом с блок-постом, то из него появляется противник (периодически) и начинает сражаться с героем. Когда героя рядом нет, то враг патрулирует около блок-поста.

Если герой пройдёт рядом с логовом Босса, то он его разбудит. Босс (оружие булава - 30 урон, здоровье 200) сразу идёт разрушать замок. Но герой может вступить с ним в схватку и победить или проиграть !!!


О проекте

Проект создан на базе 3Д моделей для моей игры в жанре "Защити башню". Уровень собирается из квадратов (prefab) с дорогами и стенами (прямые, угловые и т.д.), замком и домиком для спавна врагов. Квадраты с дорогой имеют скрипт TailRoad, за исключением квадрата окончания дороги, который используется для генерации бонусов и имеет скрипт SpawnBonus. Квадрат с домиком для спавна врагов имеет скрипт SpawnEnemy. У замка 2 скрипта: один для отслеживания получаемого "урона" и второй для управления дверями при попадании героя в соответствующий триггер. 

Карта уровня набрана квадратами вручную. Для инициализации всех спавн-элементов используется скрипт BoardMap. Можно создать из квадратов и другую прямоугольную карту, параметры которой указываются в скрипте. Скрипт сам находит квадраты с дорогами и спавн-элементами, строит на их основе поле для автоматического поиска маршрута для врагов от места спавна до замка (если нужно чтобы враги шли к замку) или до конечных точек на карте.

Prefab врага здесь единственный, но с 4 типами оружия в руке. Тип оружия можно указать в скрипте (в инспекторе) SpawnEnemy - numberEnemyArm (0, 1, 2, 3). Это значение используется для задания частоты спавна врагов и вычисления параметров врагов (HP, урон, радиус обнаружения). Выбранный тип оружия становится активным, остальные - выключены. Скрипты для врагов лежат в папке "Enemy". EnemyAttack - поиск целей для атаки, принадлежащих к Layer TargetEnemy (это Player и замок). EnemyMovement - управление перемещением по маршруту и запуск соответствующих анимаций, в том числе атака и смерть. EnemyHP - управление столбиком здоровья над головой. EnemyControl - хранение текущих параметров, связывание остальных скриптов и сообщение о смерти в LevelControl. WavePath - вспомогательный скрипт поиска кратчайшего пути на прямоугольном поле с клетками дорог, отмеченных 0 и "стенами" отмеченных -1. При наличии пути возвращается массив значений int номеров клеток, который используется для создания пути врага из точек Vector3.

Скрипты для управления действиями персонажа собраны в папке Player. По аналогии с врагом у player в руке 3 типа оружия с одним активным (меч - 5, топор - 10, булава - 20 урон). PlayerMovement управление движением персонажа, проигрывание всех анимаций, опрос пользовательского ввода. PlayerBonus - подбор бонусов при вхождении в их триггеры. В том числе для топора и булавы. SelectArm - выбор типа оружия (используется и у врагов). 2 скрипта со словом Camera в названии - управление изометрической камерой и камерой от 3 лица, которые следят за персонажем. CameraSwitcher - переключение камер по клавише TAB. PlayerControl - хранение текущих параметров игрока, реакция на их изменение и трансляция значений для отображения в UI через LevelControl.

BulletControl - скрипт нанесения урона снарядом (пулей) или триггером оружия.

В папке Level собраны скрипты управления уровнем. LevelControl управляет выводом разных параметров через скрипт UI_Control на элементы UI, а также активацией панелей магазина, победы и проигрыша. StartCamera - здесь просто показ всего уровня издали с приближением. Store - активация показа зкрана магазина при входе в триггер магазина. Нажатия на кнопки покупок в магазине вызывают изменение значений параметров в PlayerControl, которые транслируются через LevelControl для отображения в UI. 

PlaySounds отвечает за вывод звуков и добавляется к врагам, персонажу, уровню, спавнеру врагов. В инспекторе в скрипте нужно установить AudioSource для объекта с этим скриптом и добавить в массив нужные клипы для озвучки. Для проигрывания клипов из массива вызываются 2 функции. PlayClip с индексом клипа в массиве (к сожелению магические числа). PlayKick с индексом номера удара в массиве номеров ударов (нужно настроить в инспекторе индекс клипа в массиве клипов). Один скрипт используется как универсальный для озвучки звуковых эффектов. 
